Menu="IPMI:1"
Title="Settings"
---
<?php
require_once '/usr/local/emhttp/plugins/ipmitool-plugin/include/ipmitool_helpers.php';
$sName = "ipmievd";
?>

<script type="text/javascript" src="/plugins/ipmitool-plugin/js/jquery.mask.js"></script>

<form markdown="1" name="ipmitool_settings" method="POST" action="/update.php" target="progressFrame">
<input type="hidden" name="#file" value="ipmitool-plugin/ipmitool-plugin.cfg" />
<input type="hidden" id="command" name="#command" value="" />

Enable Event Notifications:
: <select id="SERVICE" name="SERVICE" size="1" onChange="checkRUNNING(this.form);">
  <?=mk_option($service, "disable", "No");?>
  <?=mk_option($service, "enable", "Yes");?>
  </select>

Enable Remote Connection:
: <select id="REMOTE" class="ipmitool-run" name="REMOTE" title="" size="1" onChange="checkREMOTE(this.form);">
  <?=mk_option($remote, "disable", "No");?>
  <?=mk_option($remote, "enable", "Yes");?>
  </select>

<label class="ipmitool-lan">IPMI IP Address:</label>
: <input id="IPADDR" type="text" class="ipmitool-lan ipmitool-ipaddr" name="IPADDR" maxlength="40" value="<?=$ipaddr;?>" title="IPMI IP address" placeholder="" >

<label class="ipmitool-lan">IPMI User Name:</label>
: <input id="USER" type="text" class="ipmitool-lan" name="USER" maxlength="40" value="<?=$user;?>" title="username for remote access IPMI" placeholder="username for remote access" >

<label class="ipmitool-lan">IPMI Password:</label>
: <input id="PASSWORD" type="password" class="ipmitool-lan" name="PASSWORD" maxlength="40" value="<?=$password;?>" title="password for remote access IPMI" placeholder="password for remote access" >

Display CPU temperature:
: <select name="CPU_TEMP">
  <?=ipmi_get_options($cpu, 'Temperature', $options);?>
  </select>

Display Motherboard temperature:
: <select name="MB_TEMP">
  <?=ipmi_get_options($mb, 'Temperature', $options);?>
  </select>

Display Fan speed:
: <select name="IPMI_FAN">
  <?=ipmi_get_options($fan, 'Fan', $options);?>
  </select>

<input id="DEFAULT" class="ipmitool-run" type="button" value="Default" onClick="resetDATA(this.form);">
: <input id="btnApply" type="submit" value="Apply" onClick="verifyDATA(this.form)"><input type="button" value="Done" onClick="done()">
</form>

<script type="text/javascript">
$(function(){
	$('.tabs')
		.append("<span class='status'>Fan Control: <?=$ipmifan_status;?> </span>")
		.append("<span class='status'>Event Notification: <?=$ipmievd_status;?> </span>");
	checkRUNNING(document.ipmitool_settings);
	checkREMOTE(document.ipmitool_settings);
	decData(document.ipmitool_settings);
	//ip address input mask
	$('.ipmitool-ipaddr').mask('0ZZ.0ZZ.0ZZ.0ZZ', {translation:  {'Z': {pattern: /[0-9]/, optional: true}}});
});

function resetDATA(form) {
	form.REMOTE.selectedIndex = 0;
	form.IPADDR.value = "";
	form.USER.value = "";
	form.PASSWORD.value = "";
	form.submit();
}

function checkRUNNING(form) {
	if ("<?=$ipmievd_running;?>" == "yes")
	{
		$(".ipmitool-run").prop("disabled", true);
		form.btnApply.disabled = "disabled";
   }else{
   	$(".ipmitool-run").prop("disabled", false);
		$("#btnApply").prop("disabled", false);
	}
	if (form.SERVICE.value == "enable")
		form.command.value = "/usr/local/emhttp/plugins/ipmitool-plugin/scripts/start";
	else {
		form.command.value = "/usr/local/emhttp/plugins/ipmitool-plugin/scripts/stop";
	}
}

function decData(form) {
 form.PASSWORD.value = atob(form.PASSWORD.value);
}

function checkREMOTE(form) {
	if (form.REMOTE.selectedIndex < 1 )
		$(".ipmitool-lan").hide();
	else
   	$(".ipmitool-lan").show();
   	$(".ipmitool-lan").prop("disabled", (form.SERVICE.value == "enable"));
}

function verifyDATA(form) {
	form.SERVICE.value = form.SERVICE.value.replace(/ /g,"_");
	form.REMOTE.value = form.REMOTE.value.replace(/ /g,"_");
	form.USER.value = form.USER.value.replace(/ /g,"_");
	form.PASSWORD.value = btoa(form.PASSWORD.value);
}
</script>
