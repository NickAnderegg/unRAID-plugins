Menu="IPMI:2"
Title="Fan Control"
Markdown="false"
---
<div id="title" style="margin-top: -22px;">&nbsp;<span class='status' id='fancontrol-status'>Fan Control: <?=$fancontrol_status;?></span>
<span class="status" style="margin-top: -30px; margin-right: -121px;"><input type="checkbox" id="advancedview"></span></div>

<form markdown="1" name="fancontrol_settings" method="POST" action="/update.php" target="progressFrame">
<input type="hidden" name="#file" value="ipmi/fan.cfg" />
<input type="hidden" id="FANCMD" name="#command" value="" />

<dl>
	<dt>Fan Control:</dt>
	<dd> 
		<select name="FANCONTROL" size="1" onChange="checkFANCONTROL(this.form);" title="Enable fan control based on selected temperature sensors">
		<?=mk_option($fancontrol, "disable", "No")?>
		<?=mk_option($fancontrol, "enable", "Yes")?>
		</select>
	</dd>
</dl>

<dl>
	<dt>Temperature Polling Time:</dt>
	<dd>
		<select id="FANPOLL" class=" fancontrol-run" name="FANPOLL" size="1" title="Amount of time between ipmi temperature checks">
		<?=mk_option($ipmipoll, "1", "1 min");?>
		<?=mk_option($ipmipoll, "2", "2 min");?>
		<?=mk_option($ipmipoll, "3", "3 min");?>
		<?=mk_option($ipmipoll, "4", "4 min");?>
		<?=mk_option($ipmipoll, "5", "5 min");?>
		<?=mk_option($ipmipoll, "10", "10 min");?>
		<?=mk_option($ipmipoll, "15", "15 min");?>
		<?=mk_option($ipmipoll, "30", "30 min");?>
  		</select>
  	</dd>
</dl>

<dl>
	<dt>Motherboard Manufacturer:</dt> 
	<dd>
		<select name="IPMIBOARD" size="1" class="fancontrol-run">
		<?=mk_option($ipmi_board, "ASRock", "ASRock")?>
		<?=mk_option($ipmi_board, "", "Other")?>
		</select>
	</dd>
</dl>

&nbsp;

<?php get_fan_options($ipmi_sensors, $fan_cfg);?>


<!-- <dl>
<input type="hidden" name="FAN0" value="<?=$ipmi_fans[0];?>"/>

<dt><?=$ipmi_sensors["$ipmi_fans[0]"]['Name'];?>: <?=$ipmi_sensors["$ipmi_fans[0]"]['Reading'];?> <?=$ipmi_sensors["$ipmi_fans[0]"]['Units'];?></dt>
<dd><?=$ipmi_sensors[$fan_cfg['FANTEMP0']]['Name'];?>: <?=$ipmi_sensors[$fan_cfg['FANTEMP0']]['Reading'];?> <?=$ipmi_sensors[$fan_cfg['FANTEMP0']]['Units'];?></dd>
</dl>

<dl class="fancontrol">
	<dt><dl><dd>Temperature sensor:</dd></dl></dt>
	<dd>
		<select name="FANTEMP0" class="fancontrol fancontrol-run">
			<option value='0'>Auto</option>
			<?=ipmi_get_options($ipmi_sensors, 'Temperature', $fan_cfg['FANTEMP0'], true);?>
		</select>
	</dd>
</dl>
<dl class="fancontrol">
	<dt><dl><dd>Low temperature threshold (&deg;C):</dd></dl></dt>
	<dd>
		<select name="TEMPLO0" class="fancontrol fancontrol-run">
			<option value='0'>Auto</option>
			<?=temp_get_options('LO', $fan_cfg['TEMPLO0']);?>
		</select>
	</dd>
</dl>
<dl class="fancontrol">
	<dt><dl><dd>High temperature threshold (&deg;C):</dd></dl></dt>
	<dd>
		<select name="TEMPHI0" class="fancontrol fancontrol-run">
			<option value='0'>Auto</option>
			<?=temp_get_options('HI', $fan_cfg['TEMPHI0']);?>
		</select>
	</dd>
</dl>
&nbsp; -->

<dl>
<dt><input id="FAN_DEFAULT" class="fancontrol fancontrol-run" type="button" value="Default" onClick="resetFANDATA(this.form);"><input type="button" value="Readings" id="readings"></dt>
<dd><input id="btnFANApply" type="submit" value="Apply" onClick="verifyFANDATA(this.form)"><input type="button" value="Done" onClick="done()"></dd>
</dl>
</form>

<script type="text/javascript">
$(function(){
	//advanced view switch set cookie and toggle advanced columns
	$('#advancedview').switchButton({
		labels_placement: 'left',
		on_label: 'Advanced View',
		off_label: 'Basic View',
		checked: ($.cookie('ipmi_fancontrol_mode') == 'advanced')
	})
	.change(function () {
		$('.fancontrol').toggle('slow');
		$.cookie('ipmi_fancontrol_mode', $('#advancedview')[0].checked ? 'advanced' : 'basic', { expires: 3650 });
	});

	$('#readings').click(function() {
		$.cookie('one', 'tab1', { expires:null, path: '/'});
		location ='/Tools/IPMITools';
	});

	checkFANCONTROL(document.fancontrol_settings);

});

function resetFANDATA(form) {
		form.submit();
}

function checkFANCONTROL(form) {
	if (form.FANCONTROL.selectedIndex < 1 ){
		form.FANCMD.value = "/usr/local/emhttp/plugins/ipmi/scripts/fancontrol_stop";
	}else {
   	form.FANCMD.value = "/usr/local/emhttp/plugins/ipmi/scripts/fancontrol_start";
   }

	if ("<?=$fancontrol_running;?>" == true)
	{
		$(".fancontrol-run").prop("disabled", true);
		form.btnFanApply.disabled = "disabled";
   }else{
   	$(".fancontrol-run").prop("disabled", false);
		$("#btnFanApply").prop("disabled", false);
	}
}

function verifyFANDATA(form) {
	form.FANCONTROL.value = form.FANCONTROL.value.replace(/ /g,"_");
}
</script>