(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){

var ko = require('knockout');
var moment = require('moment');
var components = require('ungit-components');

components.register('stash', function(args) {
  return new StashViewModel(args.server, args.repoPath);
});

function StashItemViewModel(stash, data) {
  this.stash = stash;
  this.server = stash.server;
  this.id = data.id;
  this.title = data.name + ' ' + moment(new Date(data.date)).fromNow();
  this.body = data.title;
  this.stashPopProgressBar = components.create('progressBar', { predictionMemoryKey: 'stash-pop', temporary: true });
}
StashItemViewModel.prototype.pop = function() {
  var self = this;
  this.stashPopProgressBar.start();
  this.server.del('/stashes/' + this.id, { path: this.stash.repoPath(), pop: true }, function(err, res) {
    self.stashPopProgressBar.stop();
  });
}
StashItemViewModel.prototype.drop = function() {
  var self = this;
  this.stashPopProgressBar.start();
  this.server.del('/stashes/' + this.id, { path: this.stash.repoPath() }, function(err, res) {
    self.stashPopProgressBar.stop();
  });
}

function StashViewModel(server, repoPath) {
  var self = this;
  this.server = server;
  this.repoPath = repoPath;
  this.stashedChanges = ko.observable([]);
  this.isShow = ko.observable(localStorage['showStash'] === 'true');
  this.visible = ko.computed(function() { return self.stashedChanges().length > 0 && self.isShow(); });
  this.refresh();
}

StashViewModel.prototype.updateNode = function(parentElement) {
  if (!this.isDisabled) ko.renderTemplate('stash', this, {}, parentElement);
}
StashViewModel.prototype.onProgramEvent = function(event) {
  if (event.event == 'request-app-content-refresh' ||
    event.event == 'working-tree-changed' ||
    event.event == 'git-directory-changed')
    this.refresh();
}
StashViewModel.prototype.refresh = function() {
  var self = this;
  this.server.get('/stashes', { path: this.repoPath() }, function(err, stashes) {
    if (err) {
      if (err.errorCode == 'no-such-path') return true;
      return;
    }
    self.stashedChanges(stashes.map(function(item) { return new StashItemViewModel(self, item); }));
  });
}
StashViewModel.prototype.toggleShowStash = function() {
  this.isShow(!this.isShow());
  localStorage['showStash'] = this.isShow();
}

},{"knockout":"knockout","moment":"moment","ungit-components":"ungit-components"}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJjb21wb25lbnRzL3N0YXNoL3N0YXNoLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlxudmFyIGtvID0gcmVxdWlyZSgna25vY2tvdXQnKTtcbnZhciBtb21lbnQgPSByZXF1aXJlKCdtb21lbnQnKTtcbnZhciBjb21wb25lbnRzID0gcmVxdWlyZSgndW5naXQtY29tcG9uZW50cycpO1xuXG5jb21wb25lbnRzLnJlZ2lzdGVyKCdzdGFzaCcsIGZ1bmN0aW9uKGFyZ3MpIHtcbiAgcmV0dXJuIG5ldyBTdGFzaFZpZXdNb2RlbChhcmdzLnNlcnZlciwgYXJncy5yZXBvUGF0aCk7XG59KTtcblxuZnVuY3Rpb24gU3Rhc2hJdGVtVmlld01vZGVsKHN0YXNoLCBkYXRhKSB7XG4gIHRoaXMuc3Rhc2ggPSBzdGFzaDtcbiAgdGhpcy5zZXJ2ZXIgPSBzdGFzaC5zZXJ2ZXI7XG4gIHRoaXMuaWQgPSBkYXRhLmlkO1xuICB0aGlzLnRpdGxlID0gZGF0YS5uYW1lICsgJyAnICsgbW9tZW50KG5ldyBEYXRlKGRhdGEuZGF0ZSkpLmZyb21Ob3coKTtcbiAgdGhpcy5ib2R5ID0gZGF0YS50aXRsZTtcbiAgdGhpcy5zdGFzaFBvcFByb2dyZXNzQmFyID0gY29tcG9uZW50cy5jcmVhdGUoJ3Byb2dyZXNzQmFyJywgeyBwcmVkaWN0aW9uTWVtb3J5S2V5OiAnc3Rhc2gtcG9wJywgdGVtcG9yYXJ5OiB0cnVlIH0pO1xufVxuU3Rhc2hJdGVtVmlld01vZGVsLnByb3RvdHlwZS5wb3AgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLnN0YXNoUG9wUHJvZ3Jlc3NCYXIuc3RhcnQoKTtcbiAgdGhpcy5zZXJ2ZXIuZGVsKCcvc3Rhc2hlcy8nICsgdGhpcy5pZCwgeyBwYXRoOiB0aGlzLnN0YXNoLnJlcG9QYXRoKCksIHBvcDogdHJ1ZSB9LCBmdW5jdGlvbihlcnIsIHJlcykge1xuICAgIHNlbGYuc3Rhc2hQb3BQcm9ncmVzc0Jhci5zdG9wKCk7XG4gIH0pO1xufVxuU3Rhc2hJdGVtVmlld01vZGVsLnByb3RvdHlwZS5kcm9wID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5zdGFzaFBvcFByb2dyZXNzQmFyLnN0YXJ0KCk7XG4gIHRoaXMuc2VydmVyLmRlbCgnL3N0YXNoZXMvJyArIHRoaXMuaWQsIHsgcGF0aDogdGhpcy5zdGFzaC5yZXBvUGF0aCgpIH0sIGZ1bmN0aW9uKGVyciwgcmVzKSB7XG4gICAgc2VsZi5zdGFzaFBvcFByb2dyZXNzQmFyLnN0b3AoKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIFN0YXNoVmlld01vZGVsKHNlcnZlciwgcmVwb1BhdGgpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcbiAgdGhpcy5yZXBvUGF0aCA9IHJlcG9QYXRoO1xuICB0aGlzLnN0YXNoZWRDaGFuZ2VzID0ga28ub2JzZXJ2YWJsZShbXSk7XG4gIHRoaXMuaXNTaG93ID0ga28ub2JzZXJ2YWJsZShsb2NhbFN0b3JhZ2VbJ3Nob3dTdGFzaCddID09PSAndHJ1ZScpO1xuICB0aGlzLnZpc2libGUgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHsgcmV0dXJuIHNlbGYuc3Rhc2hlZENoYW5nZXMoKS5sZW5ndGggPiAwICYmIHNlbGYuaXNTaG93KCk7IH0pO1xuICB0aGlzLnJlZnJlc2goKTtcbn1cblxuU3Rhc2hWaWV3TW9kZWwucHJvdG90eXBlLnVwZGF0ZU5vZGUgPSBmdW5jdGlvbihwYXJlbnRFbGVtZW50KSB7XG4gIGlmICghdGhpcy5pc0Rpc2FibGVkKSBrby5yZW5kZXJUZW1wbGF0ZSgnc3Rhc2gnLCB0aGlzLCB7fSwgcGFyZW50RWxlbWVudCk7XG59XG5TdGFzaFZpZXdNb2RlbC5wcm90b3R5cGUub25Qcm9ncmFtRXZlbnQgPSBmdW5jdGlvbihldmVudCkge1xuICBpZiAoZXZlbnQuZXZlbnQgPT0gJ3JlcXVlc3QtYXBwLWNvbnRlbnQtcmVmcmVzaCcgfHxcbiAgICBldmVudC5ldmVudCA9PSAnd29ya2luZy10cmVlLWNoYW5nZWQnIHx8XG4gICAgZXZlbnQuZXZlbnQgPT0gJ2dpdC1kaXJlY3RvcnktY2hhbmdlZCcpXG4gICAgdGhpcy5yZWZyZXNoKCk7XG59XG5TdGFzaFZpZXdNb2RlbC5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuc2VydmVyLmdldCgnL3N0YXNoZXMnLCB7IHBhdGg6IHRoaXMucmVwb1BhdGgoKSB9LCBmdW5jdGlvbihlcnIsIHN0YXNoZXMpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBpZiAoZXJyLmVycm9yQ29kZSA9PSAnbm8tc3VjaC1wYXRoJykgcmV0dXJuIHRydWU7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHNlbGYuc3Rhc2hlZENoYW5nZXMoc3Rhc2hlcy5tYXAoZnVuY3Rpb24oaXRlbSkgeyByZXR1cm4gbmV3IFN0YXNoSXRlbVZpZXdNb2RlbChzZWxmLCBpdGVtKTsgfSkpO1xuICB9KTtcbn1cblN0YXNoVmlld01vZGVsLnByb3RvdHlwZS50b2dnbGVTaG93U3Rhc2ggPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5pc1Nob3coIXRoaXMuaXNTaG93KCkpO1xuICBsb2NhbFN0b3JhZ2VbJ3Nob3dTdGFzaCddID0gdGhpcy5pc1Nob3coKTtcbn1cbiJdfQ==
